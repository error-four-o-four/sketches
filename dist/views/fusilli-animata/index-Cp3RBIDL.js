var It=Object.defineProperty;var Lt=(g,_,S)=>_ in g?It(g,_,{enumerable:!0,configurable:!0,writable:!0,value:S}):g[_]=S;var u=(g,_,S)=>Lt(g,typeof _!="symbol"?_+"":_,S);(function(){"use strict";const g=document.getElementById("wrapper"),_=Math.min(g.clientWidth,g.clientHeight),S=16,b=180,$=300,D=16,N=Math.floor(_/S),a={SIDE_LGTH:N,HALF_SIDE_LGTH:.5*N},F=["N","E","S","W"],U=["B","L","F","R"],m={FFFF:{weight:4,hasIntersections:!0},LLLL:{weight:2,hasIntersections:!0},BBBB:{weight:2,hasIntersections:!1},RRRR:{weight:2,hasIntersections:!1},BFBF:{weight:4,hasIntersections:!1},LRLR:{weight:6,hasIntersections:!1},LFBL:{weight:8,hasIntersections:!0},BFRR:{weight:8,hasIntersections:!1},BLRB:{weight:8,hasIntersections:!1},FFRL:{weight:8,hasIntersections:!0}},v=new RegExp(`[${U.join("")}]{4,}`);Object.keys(m).forEach(t=>{if(!v.test(t))throw new TypeError("Nope")});function w(t){const e=new Map,i=Object.keys(m).reduce((h,L)=>{const T=m[L].weight;return[...h,...Array.from({length:T},()=>L)]},[]),{SIDE_LGTH:o,HALF_SIDE_LGTH:c}=a;let s;for(let h=0;h<t;h+=1)for(let L=0;L<t;L+=1)s=`${L}.${h}`,e.set(s,r(L,h));function r(h,L){const T=l(),C=I();return{type:T,lanes:f(T,C),col:h,row:L,rotation:C,position:A(h,L),center:d(h,L)}}function l(){const h=Math.floor(Math.random()*i.length);return i[h]}function I(){return Math.floor(Math.random()*4)}function f(h,L){let T=0;for(;T<L;)h=h.slice(-1)+h.slice(0,3),T+=1;return h}function A(h,L){return[h*o,L*o]}function d(h,L){return[h*o+c,L*o+c]}return e}function G(t){return F.indexOf(t)}function W(t){return F[t]}function x(t,e){if(e==="F")return t;const i=["F","R","B","L"],o=(F.indexOf(t)+i.indexOf(e))%F.length;return F[o]}const[j,V,K,X]=U;function q(t){if(!(t===j||t===V||t===K||t===X))throw new Error("Nope")}function Q(t,e){return t.charAt(G(e))}function Z(t,e){const i=t.charAt(typeof e=="string"?G(e):e);return q(i),i}function p(t,e,i){return`${t}${e}${i}`}function O(t){const e=t.slice(0,-2);return[e,...e.split(".").map(i=>parseInt(i)),...t.slice(-2).split("")]}function z(t,e,i,o){const c=[[0,1],[-1,0],[0,-1],[1,0]],s=F.indexOf(o);if(s<0||(e+=c[s][0],i+=c[s][1],k(e,i)))return;const r=`${e}.${i}`,l=t.get(r);return l?[r,l]:void 0}function J(t,e,i,o){const c=[[0,-1],[1,0],[0,1],[-1,0]],s=F.indexOf(o);if(s<0||(e+=c[s][0],i+=c[s][1],k(e,i)))return;const r=`${e}.${i}`,l=t.get(r);return l?[r,l]:void 0}function k(t,e){return t<0||e<0||t>=S||e>=S}function Y(t,e){const i=t.lanes.split("");let o,c;for(let s=0;s<i.length;s+=1)if(o=F[s],c=i[s],x(o,i[s])===e)return[o,c];throw new Error("Nope!")}function tt(t,e,i){const o=[e],c=t.size*4;let s=0,r=o[0];for(i.setOccupied(r);s<c&&(r=et(t,o[o.length-1]),!(!r||i.isOccupied(r)));){if(i.setOccupied(r),o.push(r),e===r)return o.pop(),o;s+=1,s===c&&console.warn("Hit max depth!")}for(s=0;s<c&&(r=nt(t,o[0]),!(!r||i.isOccupied(r)));)i.setOccupied(r),o.unshift(r),s+=1,s===c&&console.warn("Hit max depth!");return o}function et(t,e){const[,i,o,c,s]=O(e),r=x(c,s),[l,I]=z(t,i,o,r)??[];if(!l||!I)return;const f=Q(I.lanes,r);return p(l,r,f)}function nt(t,e){const[,i,o,c]=O(e),[s,r]=J(t,i,o,c)??[];if(!s||!r)return;const[l,I]=Y(r,c)??[];return p(s,l,I)}class B{constructor(){u(this,"occupied");u(this,"col");u(this,"row");u(this,"edge");u(this,"done");this.occupied=new Set,this.col=0,this.row=0,this.edge=0,this.done=!1}iterate(){this.edge+=1,this.edge%=F.length,this.edge===0&&(this.col+=1,this.col%=S),this.edge===0&&this.col===0&&(this.row+=1),this.row===S&&(this.done=!0)}getNextPossible(e){const i=`${this.col}.${this.row}`,o=e.get(i);if(!o){this.done=!0;return}const c=W(this.edge),s=Z(o.lanes,c);return p(i,c,s)}isOccupied(e){return this.occupied.has(e)}getNextUnoccupied(e){let i=this.getNextPossible(e);for(;i&&this.isOccupied(i);)this.iterate(),i=this.getNextPossible(e);return i||(this.done=!0),i}setOccupied(e){this.occupied.add(e)}}const n={OFFSET:.3*a.HALF_SIDE_LGTH,PADDING:.05*a.HALF_SIDE_LGTH,RADIUS_SMALL:.325*a.HALF_SIDE_LGTH,RADIUS_BIG:.5*a.HALF_SIDE_LGTH,WEIGHT_THICK:Math.max(1.5,.35*a.HALF_SIDE_LGTH),WEIGHT_THIN:Math.max(1,.175*a.HALF_SIDE_LGTH)},st=[[1,0],[0,1],[-1,0],[0,-1]],P={B:[[-n.OFFSET,-a.HALF_SIDE_LGTH],[-n.OFFSET,-a.HALF_SIDE_LGTH+n.PADDING],[-n.OFFSET+n.RADIUS_SMALL,-a.HALF_SIDE_LGTH+n.PADDING],[-n.OFFSET+n.RADIUS_SMALL,-a.HALF_SIDE_LGTH+n.PADDING+n.RADIUS_SMALL],[n.OFFSET-n.RADIUS_SMALL,-a.HALF_SIDE_LGTH+n.PADDING+n.RADIUS_SMALL],[n.OFFSET-n.RADIUS_SMALL,-a.HALF_SIDE_LGTH+n.PADDING],[n.OFFSET,-a.HALF_SIDE_LGTH+n.PADDING],[n.OFFSET,-a.HALF_SIDE_LGTH]],L:[[-n.OFFSET,-a.HALF_SIDE_LGTH],[-n.OFFSET,-a.HALF_SIDE_LGTH+n.PADDING],[-n.OFFSET+n.RADIUS_BIG,-a.HALF_SIDE_LGTH+n.PADDING],[-n.OFFSET+n.RADIUS_BIG+Math.cos(.75*Math.PI)*n.RADIUS_BIG,-a.HALF_SIDE_LGTH+n.PADDING+Math.sin(.75*Math.PI)*n.RADIUS_BIG],[a.HALF_SIDE_LGTH-n.PADDING+Math.cos(.75*Math.PI)*n.RADIUS_BIG,n.OFFSET-n.RADIUS_BIG+Math.sin(.75*Math.PI)*n.RADIUS_BIG],[a.HALF_SIDE_LGTH-n.PADDING,n.OFFSET-n.RADIUS_BIG],[a.HALF_SIDE_LGTH-n.PADDING,n.OFFSET],[a.HALF_SIDE_LGTH,n.OFFSET]],F:[[-n.OFFSET,-a.HALF_SIDE_LGTH],[-n.OFFSET,a.HALF_SIDE_LGTH]],R:[[-n.OFFSET,-a.HALF_SIDE_LGTH],[-n.OFFSET,-a.HALF_SIDE_LGTH+n.PADDING],[-n.OFFSET-n.RADIUS_SMALL,-a.HALF_SIDE_LGTH+n.PADDING],[-n.OFFSET-n.RADIUS_SMALL+Math.cos(.25*Math.PI)*n.RADIUS_SMALL,-a.HALF_SIDE_LGTH+n.PADDING+Math.sin(.25*Math.PI)*n.RADIUS_SMALL],[-a.HALF_SIDE_LGTH+n.PADDING+Math.cos(.25*Math.PI)*n.RADIUS_SMALL,-n.OFFSET-n.RADIUS_SMALL+Math.sin(.25*Math.PI)*n.RADIUS_SMALL],[-a.HALF_SIDE_LGTH+n.PADDING,-n.OFFSET-n.RADIUS_SMALL],[-a.HALF_SIDE_LGTH+n.PADDING,-n.OFFSET],[-a.HALF_SIDE_LGTH,-n.OFFSET]]},it={B:[.5*Math.PI,Math.PI,0,.5*Math.PI],L:[.75*Math.PI,Math.PI,.5*Math.PI,.75*Math.PI],F:[0,0,0,0],R:[0,.25*Math.PI,.25*Math.PI,.5*Math.PI]},ot=Object.fromEntries(Object.keys(P).map(t=>[t,ct(P[t])])),R=Object.fromEntries(Object.keys(P).map(t=>[t,at(it[t])]));function rt(t,e,i){const o=st[i];return[t*o[0]-e*o[1],t*o[1]+e*o[0]]}function ct(t){return Array.from({length:4},(e,i)=>t.map(o=>rt(...o,i)))}function at(t){return Array.from({length:4},(e,i)=>t.map(o=>o+i*.5*Math.PI))}const y={B(t,e,i,o){const c="B",s=M(c,e,i,o),r=R[c][o];t.line(...s[0],...s[1]),t.arc(...s[2],n.RADIUS_SMALL,n.RADIUS_SMALL,r[0],r[1]),t.line(...s[3],...s[4]),t.arc(...s[5],n.RADIUS_SMALL,n.RADIUS_SMALL,r[2],r[3]),t.line(...s[6],...s[7])},L(t,e,i,o){const c="L",s=M(c,e,i,o),r=R[c][o];t.line(...s[0],...s[1]),t.arc(...s[2],n.RADIUS_BIG,n.RADIUS_BIG,r[0],r[1]),t.line(...s[3],...s[4]),t.arc(...s[5],n.RADIUS_BIG,n.RADIUS_BIG,r[2],r[3]),t.line(...s[6],...s[7])},F(t,e,i,o){const s=M("F",e,i,o);t.line(...s[0],...s[1])},R(t,e,i,o){const c="R",s=M(c,e,i,o),r=R[c][o];t.line(...s[0],...s[1]),t.arc(...s[2],n.RADIUS_SMALL,n.RADIUS_SMALL,r[0],r[1]),t.line(...s[3],...s[4]),t.arc(...s[5],n.RADIUS_SMALL,n.RADIUS_SMALL,r[2],r[3]),t.line(...s[6],...s[7])}};function M(t,e,i,o){return ot[t][o].map(c=>[e+c[0],i+c[1]])}const{WEIGHT_THICK:lt,WEIGHT_THIN:ht}=n,E=class E{constructor(e,i,o,c){u(this,"parsed");u(this,"colors");u(this,"birthtime");u(this,"lifetime");u(this,"duration");u(this,"done");this.parsed=[],this.birthtime=e.frameCount,this.lifetime=0,this.duration=Math.max(b,Math.min($,c.length+D)),this.done=!1,this.colors=E.createColors(e,i,c);let s,r,l,I,f,A,d;c.forEach(h=>{[s,,,l,I]=O(h),r=o.get(s),r&&([f,A]=r.center,d=G(l),this.parsed.push({lane:I,x:f,y:A,rotation:d}))})}static shuffleColorValues(){const e=i=>i[Math.floor(Math.random()*i.length)];this.hue_offset=e([0,60,120,180,240,300]),this.hue_delta=e([60,120,180]),this.sat_min=25,this.sat_delta=50,this.lgt_min=20,this.lgt_delta=40}static createColors(e,i,o){const c=Math.floor((this.hue_offset+this.hue_delta*Math.random())%360),s=this.sat_min+this.sat_delta*Math.random(),r=this.lgt_min+Math.min(this.lgt_delta,2*o.length),l=e.color(`hsl(${c}, 100%, 100%)`),I=e.color(`hsl(${c}, ${s}%, ${r}%)`),f=[];let A;for(let d=0;d<D;d+=1)A=d/(D-1),f.push(e.lerpColor(l,I,A));for(let d=0;d<D;d+=1)A=d/(D-1),f.push(e.lerpColor(I,i,A));return f}draw(e,i){if(this.lifetime=e.frameCount-this.birthtime,this.lifetime===0||this.done===!0)return;if(this.lifetime-this.duration-this.parsed.length-2*D>0){console.log("Done"),this.done=!0;return}const o=Math.min(this.lifetime,this.parsed.length);let c,s;for(let r=0;r<o;r+=1){if(this.lifetime-this.duration-r-2*D>0)continue;const{lane:l,x:I,y:f,rotation:A}=this.parsed[r];c=this.lifetime<this.duration?Math.max(0,Math.min(D-1,this.lifetime-r)):Math.max(D,Math.min(this.colors.length-1,this.lifetime-this.duration-r)),s=this.colors[c],e.stroke(i),e.strokeWeight(lt),e.strokeCap(e.SQUARE),y[l](e,I,f,A),e.strokeWeight(ht),e.strokeCap(e.ROUND),e.stroke(s),y[l](e,I,f,A)}}};u(E,"hue_offset"),u(E,"hue_delta"),u(E,"sat_min"),u(E,"sat_delta"),u(E,"lgt_min"),u(E,"lgt_delta");let H=E;const ut=t=>{let e=w(S),i=new B,o=[],c=[],s;t.setup=()=>{t.createCanvas(_,_),t.ellipseMode(t.RADIUS),t.background(s=t.color("hsl(0, 0%, 8%)")),H.shuffleColorValues()},t.draw=()=>{t.background(s);const r=i.done?null:i.getNextUnoccupied(e);if(r){const l=tt(e,r,i);o.push(l);const I=new H(t,s,e,l);c.push(I)}t.noFill(),c.forEach(l=>l.draw(t,s)),c.every(l=>l.done)&&(e=w(S),i=new B,o=[],c=[],H.shuffleColorValues())},t.mouseClicked=r=>{t.isLooping()?t.noLoop():t.loop()}};new window.p5(ut,document.getElementById("wrapper"))})();
