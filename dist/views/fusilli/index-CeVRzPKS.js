var pt=Object.defineProperty;var Rt=(E,d,D)=>d in E?pt(E,d,{enumerable:!0,configurable:!0,writable:!0,value:D}):E[d]=D;var A=(E,d,D)=>Rt(E,typeof d!="symbol"?d+"":d,D);(function(){"use strict";var E=document.createElement("style");E.textContent=`main{max-width:1280px;margin:0 auto;padding:0}#wrapper.loading:after{content:"Loading ...";display:block;position:absolute;padding:.25rem .5rem;background-color:#262626;box-shadow:2px 2px 1rem #0006;border-radius:.125rem}#body{position:relative}#body pre{background-color:#0003;padding:.75rem 1.25rem}#body div{padding:.75rem 0 1.25rem}#body div>img{display:block;position:relative;max-width:100%;margin:0 auto 2rem}#body .col-2{display:grid;grid-template-columns:auto auto;column-gap:1rem}
`,document.head.appendChild(E);const d="#",D={SIZE:32},F=["N","E","S","W"],J=["B","L","F","R"],T={FFFF:{weight:4,hasIntersections:!0},LLLL:{weight:2,hasIntersections:!0},BBBB:{weight:2,hasIntersections:!1},RRRR:{weight:2,hasIntersections:!1},BFBF:{weight:4,hasIntersections:!1},LRLR:{weight:6,hasIntersections:!1},LFBL:{weight:8,hasIntersections:!0},BFRR:{weight:8,hasIntersections:!1},BLRB:{weight:8,hasIntersections:!1},FFRL:{weight:8,hasIntersections:!0}},K=new RegExp(`[${J.join("")}]{4,}`);Object.keys(T).forEach(t=>{if(!K.test(t))throw new TypeError("Nope")});const H=V();function V(){let t=Date.now(),e=0;const n=s=>{const r=Date.now();e=r-t,t=r,console.log(`${s} +${e}ms`)};return n.reset=()=>t=Date.now(),n}const m=document.getElementById("wrapper"),q=(m==null?void 0:m.clientHeight)??window.innerHeight,z=(m==null?void 0:m.clientWidth)??window.innerWidth,N=Math.floor(Math.min(q,z)/D.SIZE),c={SIDE_LGTH:N,HALF_SIDE_LGTH:.5*N},o={OFFSET:.3*c.HALF_SIDE_LGTH,PADDING:.05*c.HALF_SIDE_LGTH,RADIUS_SMALL:.325*c.HALF_SIDE_LGTH,RADIUS_BIG:.5*c.HALF_SIDE_LGTH,WEIGHT_THICK:Math.max(1.5,.35*c.HALF_SIDE_LGTH),WEIGHT_THIN:Math.max(1,.175*c.HALF_SIDE_LGTH)},Q=[[1,0],[0,1],[-1,0],[0,-1]],y={B:[[-o.OFFSET,-c.HALF_SIDE_LGTH],[-o.OFFSET,-c.HALF_SIDE_LGTH+o.PADDING],[-o.OFFSET+o.RADIUS_SMALL,-c.HALF_SIDE_LGTH+o.PADDING],[-o.OFFSET+o.RADIUS_SMALL,-c.HALF_SIDE_LGTH+o.PADDING+o.RADIUS_SMALL],[o.OFFSET-o.RADIUS_SMALL,-c.HALF_SIDE_LGTH+o.PADDING+o.RADIUS_SMALL],[o.OFFSET-o.RADIUS_SMALL,-c.HALF_SIDE_LGTH+o.PADDING],[o.OFFSET,-c.HALF_SIDE_LGTH+o.PADDING],[o.OFFSET,-c.HALF_SIDE_LGTH]],L:[[-o.OFFSET,-c.HALF_SIDE_LGTH],[-o.OFFSET,-c.HALF_SIDE_LGTH+o.PADDING],[-o.OFFSET+o.RADIUS_BIG,-c.HALF_SIDE_LGTH+o.PADDING],[-o.OFFSET+o.RADIUS_BIG+Math.cos(.75*Math.PI)*o.RADIUS_BIG,-c.HALF_SIDE_LGTH+o.PADDING+Math.sin(.75*Math.PI)*o.RADIUS_BIG],[c.HALF_SIDE_LGTH-o.PADDING+Math.cos(.75*Math.PI)*o.RADIUS_BIG,o.OFFSET-o.RADIUS_BIG+Math.sin(.75*Math.PI)*o.RADIUS_BIG],[c.HALF_SIDE_LGTH-o.PADDING,o.OFFSET-o.RADIUS_BIG],[c.HALF_SIDE_LGTH-o.PADDING,o.OFFSET],[c.HALF_SIDE_LGTH,o.OFFSET]],F:[[-o.OFFSET,-c.HALF_SIDE_LGTH],[-o.OFFSET,c.HALF_SIDE_LGTH]],R:[[-o.OFFSET,-c.HALF_SIDE_LGTH],[-o.OFFSET,-c.HALF_SIDE_LGTH+o.PADDING],[-o.OFFSET-o.RADIUS_SMALL,-c.HALF_SIDE_LGTH+o.PADDING],[-o.OFFSET-o.RADIUS_SMALL+Math.cos(.25*Math.PI)*o.RADIUS_SMALL,-c.HALF_SIDE_LGTH+o.PADDING+Math.sin(.25*Math.PI)*o.RADIUS_SMALL],[-c.HALF_SIDE_LGTH+o.PADDING+Math.cos(.25*Math.PI)*o.RADIUS_SMALL,-o.OFFSET-o.RADIUS_SMALL+Math.sin(.25*Math.PI)*o.RADIUS_SMALL],[-c.HALF_SIDE_LGTH+o.PADDING,-o.OFFSET-o.RADIUS_SMALL],[-c.HALF_SIDE_LGTH+o.PADDING,-o.OFFSET],[-c.HALF_SIDE_LGTH,-o.OFFSET]]},X={B:[.5*Math.PI,Math.PI,0,.5*Math.PI],L:[.75*Math.PI,Math.PI,.5*Math.PI,.75*Math.PI],F:[0,0,0,0],R:[0,.25*Math.PI,.25*Math.PI,.5*Math.PI]},Y=Object.fromEntries(Object.keys(y).map(t=>[t,et(y[t])])),P=Object.fromEntries(Object.keys(y).map(t=>[t,nt(X[t])]));function tt(t,e,n){const s=Q[n];return[t*s[0]-e*s[1],t*s[1]+e*s[0]]}function et(t){return Array.from({length:4},(e,n)=>t.map(s=>tt(...s,n)))}function nt(t){return Array.from({length:4},(e,n)=>t.map(s=>s+n*.5*Math.PI))}function ot(t,e){return[t*c.SIDE_LGTH,e*c.SIDE_LGTH]}function st(t,e){return[t*c.SIDE_LGTH+c.HALF_SIDE_LGTH,e*c.SIDE_LGTH+c.HALF_SIDE_LGTH]}const b=Object.keys(T).reduce((t,e)=>{const n=T[e].weight;return[...t,...Array.from({length:n},()=>e)]},[]);function rt(){const t=Math.floor(Math.random()*b.length);return b[t]}function it(){return Math.floor(Math.random()*4)}function ct(t,e){let n=0;for(;n<e;)t=t.slice(-1)+t.slice(0,3),n+=1;return t}function at(t,e){const n=rt(),s=it();return{type:n,lanes:ct(n,s),rotation:s,position:ot(t,e),center:st(t,e)}}function U(t,e,n){return`${t}${e}${n}`}function x(t){const e=M(t);return[e.slice(0,-2),...e.slice(-2).split("")]}function M(t){return t.includes(d)?t.split(d)[0]:t}function lt(t){return t.split(d)[1]??null}function B(t,e){const n=F.indexOf(e);return t.charAt(n)}function ht(t,e){if(e==="F")return t;const n=["F","R","B","L"],s=(F.indexOf(t)+n.indexOf(e))%F.length;return F[s]}function It(t,e){let[n,s]=t.split(".").map(r=>parseInt(r));switch(e){case"N":s+=1;break;case"E":n-=1;break;case"S":s-=1;break;case"W":n+=1;break}if(!(n<0||s<0||n>=D.SIZE||s>=D.SIZE))return`${n}.${s}`}const{SIZE:G}=D;class dt{constructor(e){A(this,"type");A(this,"config");A(this,"data",new Set);A(this,"generator");this.type=g()?"rgb":"hsl",this.config=this.type==="rgb"?C(this.type):C(this.type),this.generator=this.type==="rgb"?Lt(this.config):Dt(this.config,e),H(JSON.stringify({type:this.type,vals:this.config},null,2))}process(e){const[n,s]=ut(e),[r,i,a]=this.generator(n,s,e.length),h=this.type==="rgb"?`rgb(${r}, ${i}, ${a})`:`hsl(${r}, ${i}%, ${a}%)`;return this.data.add(h),h}}function C(t){return t==="rgb"?{min:34,max:255,delta:221}:{hueOff:Math.floor(270*Math.random()),hueDelta:[90,180][Math.floor(2*Math.random())],hueJitter:30,lgtMin:20,lgtDelta:60}}function ut(t){const e=t.reduce((n,s)=>{const[r,i]=M(s).slice(0,-2).split(".").map(a=>parseInt(a));return n[0]=Math.min(n[0],r),n[1]=Math.max(n[1],r),n[2]=Math.min(n[2],i),n[3]=Math.max(n[3],i),n},[1/0,-1/0,1/0,-1/0]);return[e[0]+.5*(e[1]-e[0]),e[2]+.5*(e[3]-e[2])]}function g(t=.5){return Math.random()<t}function Lt(t){const e=[g(),g(),g()],n=g()?[e[0],!e[1],!e[2]]:[!e[0],g(),g()],s=ft([v(...e),v(...n),g()?.25:.75]),r=(i,a)=>s.map(h=>typeof h=="function"?h(i,a):h);return(i,a,h)=>(i/=G,a/=G,r(i,a).map(l=>At(t.min+l*t.delta)))}function v(t,e,n){return(s,r)=>St(t?s:r,e,n)}function St(t,e,n){return e&&(t=Math.abs(t*2-1)),t+=.2*(Math.random()*(g()?1:-1)),n?1-t:t}function ft(t){let e=t.length;for(;e!=0;){let n=Math.floor(Math.random()*e);e--,[t[e],t[n]]=[t[n],t[e]]}return t}function At(t){return Math.max(0,Math.min(255,Math.round(t)))}function Dt(t,e){const n=e.reduce((s,r)=>r.length>s?r.length:s,-1/0);return(s,r,i)=>{s/=G,r/=G;const a=Math.atan2(r-.5,s-.5)/Math.PI,h=i/n,u=Math.random()*(g()?1:-1),l=t.hueOff+a*t.hueDelta+u*t.hueJitter,I=t.lgtMin+h*t.lgtDelta;return[(l+360)%360,100,I].map(S=>Math.floor(S))}}class ${constructor(e){A(this,"size");A(this,"tiles");A(this,"maxDepth");A(this,"graphs");A(this,"parsed");A(this,"colors");this.size=e,this.maxDepth=e*e*4,this.tiles=gt(this),H("Created Grid"),this.graphs=_t(this),H("Processed Grid");const{parsed:n,colors:s}=Ft(this);this.parsed=n,this.colors=s}}function gt({size:t}){const e=new Map;let n;for(let s=0;s<t;s+=1)for(let r=0;r<t;r+=1)n=`${r}.${s}`,e.set(n,at(r,s));return e}function _t({tiles:t,maxDepth:e}){const n=new Set,s=new Map,r=[];for(const[i,a]of t.entries())for(const h of F){let u=U(i,h,B(a.lanes,h));if(n.has(u))continue;let l=[u],I,S=0;for(;S<e&&(I=Et(t,l,n),!!I);)l.push(I),S+=1;S===e&&console.warn("Hit max depth!");const L=M(l[0]),f=lt(l[l.length-1]);if(L===f){r.push(l);continue}if(!f){s.set(L,l);continue}if(s.has(f)){l=[...l,...s.get(f)??[]],s.delete(f),s.set(L,l);continue}}return[...r,...s.values()]}function Et(t,e,n){const s=e.at(-1);if(!s){console.warn("Something went wrong");return}const r=M(s);n.add(r);const[i,a,h]=x(r),u=ht(a,h),l=It(i,u);if(!l)return;const I=t.get(l);if(!I)return;const S=B(I.lanes,u),L=U(l,u,S);if(e[e.length-1]=`${r}${d}${L}`,L!==e[0].split(d)[0]&&!n.has(L))return L}function Ft({tiles:t,graphs:e}){const n=new Map,s=new Map,r=new dt(e);return e.forEach((i,a)=>{const h=r.process(i);for(const u of i){const[l,I,S]=x(u),L=t.get(l);if(!L){console.warn("Could not get tile %o",l);continue}const f=n.get(l)??{coords:L.center,edges:{},hasIntersections:T[L.type].hasIntersections};I in f.edges&&console.warn("MÃ¶hp"),f.edges[I]={lane:S,color:h};const Z=Object.keys(f.edges);if(Z.length===4&&F.every(Gt=>Z.includes(Gt))){s.set(l,f),n.delete(l);continue}n.set(l,f)}}),{parsed:s,colors:r.data}}const W={B(t,e,n,s){const r="B",i=p(r,e,n,s),a=P[r][s];t.line(...i[0],...i[1]),t.arc(...i[2],o.RADIUS_SMALL,o.RADIUS_SMALL,a[0],a[1]),t.line(...i[3],...i[4]),t.arc(...i[5],o.RADIUS_SMALL,o.RADIUS_SMALL,a[2],a[3]),t.line(...i[6],...i[7])},L(t,e,n,s){const r="L",i=p(r,e,n,s),a=P[r][s];t.line(...i[0],...i[1]),t.arc(...i[2],o.RADIUS_BIG,o.RADIUS_BIG,a[0],a[1]),t.line(...i[3],...i[4]),t.arc(...i[5],o.RADIUS_BIG,o.RADIUS_BIG,a[2],a[3]),t.line(...i[6],...i[7])},F(t,e,n,s){const i=p("F",e,n,s);t.line(...i[0],...i[1])},R(t,e,n,s){const r="R",i=p(r,e,n,s),a=P[r][s];t.line(...i[0],...i[1]),t.arc(...i[2],o.RADIUS_SMALL,o.RADIUS_SMALL,a[0],a[1]),t.line(...i[3],...i[4]),t.arc(...i[5],o.RADIUS_SMALL,o.RADIUS_SMALL,a[2],a[3]),t.line(...i[6],...i[7])}};function p(t,e,n,s){return Y[t][s].map(r=>[e+r[0],n+r[1]])}const _=document.getElementById("wrapper");_==null||_.classList.add("loading");const{SIZE:R}=D,{SIDE_LGTH:k}=c,{WEIGHT_THICK:Ht,WEIGHT_THIN:mt}=o;let O=new $(R),w={};const Tt=t=>{t.setup=()=>{t.createCanvas(R*k,R*k),t.ellipseMode(t.RADIUS),t.noLoop(),w=j(t,O.colors),H("Finished Setup")},t.draw=()=>{t.background(w.background),Mt(t,O),H("Finished Draw"),_==null||_.classList.remove("loading")},t.mouseClicked=e=>{e instanceof UIEvent&&e.target instanceof HTMLCanvasElement&&(_==null||_.classList.add("loading"),setTimeout(()=>{H.reset(),O=new $(R),w=j(t,O.colors),t.redraw(1)},300))}};function j(t,e){return{background:t.color(17),...[...e].reduce((n,s)=>({...n,[s]:t.color(s)}),{})}}function Mt(t,e){const n=w.background;let s,r;t.noFill(),t.strokeWeight(Math.max(1,.1*k)),[...e.parsed.values()].forEach((a,h)=>{[s,r]=a.coords,["N","E","S","W"].forEach((u,l)=>{const{lane:I,color:S}=a.edges[u];a.hasIntersections&&(t.stroke(n),t.strokeWeight(Ht),t.strokeCap(t.SQUARE),W[I](t,s,r,l)),t.stroke(S),t.strokeWeight(mt),t.strokeCap(t.ROUND),W[I](t,s,r,l)})})}new window.p5(Tt,document.getElementById("wrapper"))})();
